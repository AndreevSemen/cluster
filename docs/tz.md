# Техническое задание

## Цель работы

Проверить можно ли реализовать кластер так, чтобы узлы кластера, которые общаются с помощью протокола, основанного на "слухах" (gossip-протокола), узнавали о каких-либо событиях, произошедших внутри кластера за алгоритмическую сложность O(log log N), где N -- размер кластера.

Составить графики для подтверждения этого предположения (ось абсцисс – время, ординат – количество узлов, которые знают о событии).

## Задачи

Для данной цели необходимо реализовать:

- кластер из docker-контейнеров, объединенных между собой сетью
- программа, обеспечивающая взаимодействие узлов по gossip-протоколу
- средства для имитации реальных сетевых условий
- средства для мониторинга состояния кластера

##  Описание исследовательской части

- [Docker documentation](https://docs.docker.com/reference/)
- [Материалы с Tarantool Conference (SWIM -- протокол построения кластера)](https://conf.tarantool.io/2019/abstracts/5407) помогают поняь общее строение gossip-протокола.
- [Создание сетевых приложений в среде Linux. Руководство разработчика](https://www.net4me.net/docs/pdf/Develop/linux_make_netservice_rubook.pdf)

## Описание реализации решения

### Кластер:
Для кластера будут использованы docker-контейнеры, расположенные на одной машине, которые будут коммуницировать между собой при помощи macvlan-сети.
В состав кластера будут входить: рабочие узлы и `master`-узел, собирающий информацию об остальных узлах.

Рабочий узел будет иметь 3 составляющие:
- Приложение, которая будет работать с данными, переданными узлу для обработки запроса и получения ответа. Это может быть любая программа, написанная на языке, способном использовать предоставляемый протокольной программой API.
- Протокольная программа, обеспечивающая взаимодействие с остальными рабочими узлами. Она будет отправлять и получать gossip-протоколы, хранить таблицу членов кластера с их состояниями, передавать и получать данные для обработки приложением, передавать состояния собственного и остальных узлов кластера программе для аналитики кластера. Будет использован язык `C`.
- Программа для аналитики кластера, передающая состояние собственного узла и предполагаемое состояние остальных узлов master'у, `а также отдача команд для имитации реального сетевого взаимодействия протокольной программе (но пока не определился, я не могу убрать этот текст из комментария)`. Будет использован язык `python`. `(он удобный, я на нем даже что-то ковырял, и от нас не требуется какого-то низкоуровневого, супербыстрого и суперэффективного языка в данной части системы (да, я, пожалуй, выберу скорость разработки, потому что итак огромная часть системы пишется на C) )`.

### Gossip-протокол:
Протокол будет реализован на языке C.
Коммуницирование между узлами будет происходить с помощью UDP-пакетов по двум причинам:
- увеличения скорости распространения пакетов
- чтобы не терять время на налаживание TCP-потока с узлом, который, возможно, вышел из строя и не может отвечать

Для достижения алгоритмической сложности O(log log N) слухи будут распространяться по типу push-pull (если узел хочет передать кому-либо прикладные данные, он дополнительно вложет в него служебные данные (список произошедших событий), а если получает от кого-либо полезную нагрузку, то он узнает о событиях в кластере).

### Средства приближения к реальности:
`(Пока)
Данные средства будут реализованы при помощи узла-мастера. Т.е. необходимо задать какие-то параметры помех сети: вероятность потери пакета (машина-мастер случайно выбирает узел и говорит ему, мол, не принимай следующий пакет), плановый выход из строя (аналогично, мастер говорит, мол, усни на n секунд, не принимай ни одного пакета либо попрощайся и выйди из кластера) или раздержка пакета.`

`На самом деле у меня есть еще 2 идеи насчет реализации имитации реального взаимодействия:`

`- убрать отдачу команд от master'а к рабочим узлам и сделать ответственным за это саму сеть (т.е. она иногда будет нарочно терять некоторые пакеты, а также отправлять пакеты со специальным содержанием, говорящие прикладной программе заснуть, выйти или умереть). Пока я абсолютно не знаю как это прикрутить, но считаю, что это будет наиболее удобно, потому что, если убрать этот распределитель с сети и расставить ноды по разным машинам, то получится самый настоящий реальный кластер)`

`- поставить данную задачу на приложение`


### Средства для мониторинга:

`Пока знаю только то, что мастер будет собирать информацию, составлять из нее какую структуру, похожую на таблицу и выводить каким-то способом на экран (возможно, через браузер). Также можно попробывать все логировать определенными структурами, а потом из этих логов смотреть`


## Описание экспериментальной части

`comment begin`
Основывается на `Описание исследовательской части` и `Описание реализации решения`. Но, поскольку они еще не готовы и я пока не не до конца понял, в каких условия это будет проходить, написать сейчас у меня ничего не получится.

Но все сводится к тому, чтобы запустить это на большой тачке, собрать данные и построить графики.
`comment end`
